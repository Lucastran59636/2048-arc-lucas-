<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>2048 on Arc Testnet - Lucas Builder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/viem@2.x/dist/viem.js"></script>
  <script src="https://unpkg.com/@wagmi/core@2.x/dist/index.js"></script>
  <script src="https://unpkg.com/@wagmi/connectors@2.x/dist/index.js"></script>
  <style>
    .tile { transition: all 0.2s; }
    .tile-2 { background: #eee4da; color: #776e65; }
    .tile-4 { background: #ede0c8; color: #776e65; }
    .tile-8 { background: #f2b179; color: #f9f6f2; }
    .tile-16 { background: #f59563; color: #f9f6f2; }
    .tile-32 { background: #f67c5f; color: #f9f6f2; }
    .tile-64 { background: #f65e3b; color: #f9f6f2; }
    .tile-128 { background: #edcf72; color: #f9f6f2; font-size: 45px; }
    .tile-256 { background: #edcc61; color: #f9f6f2; font-size: 45px; }
    .tile-512 { background: #edc850; color: #f9f6f2; font-size: 45px; }
    .tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 35px; }
    .tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 35px; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center">
  <h1 class="text-6xl font-bold mb-4">2048 on Arc</h1>
  <p class="text-xl mb-8">by Lucas Builder üáªüá≥</p>
  <div id="score" class="text-4xl mb-4">Score: 0</div>

  <div id="grid" class="grid grid-cols-4 gap-4 bg-gray-700 p-4 rounded-lg"></div>

  <button id="submitBtn" class="mt-8 px-8 py-4 bg-green-600 rounded text-2xl hidden">
    Submit High Score to Arc Chain
  </button>

  <button id="connectBtn" class="mt-8 px-8 py-4 bg-blue-600 rounded text-2xl">
    Connect Wallet
  </button>

  <script>
    const CONTRACT = "0x6f023FAcF0cCA8D6D09DeCF2f1D511EDC12B2077"; // contract c·ªßa b·∫°n
    const ABI = [{"inputs":[{"internalType":"uint256","name":"score","type":"uint256"}],"name":"submitScore","outputs":[],"stateMutability":"nonpayable","type":"function"}];

    const client = viem.createPublicClient({
      chain: { id: 5042002, name: 'Arc Testnet', rpcUrls: { default: { http: ['https://rpc.testnet.arc.xyz'] } } },
      transport: viem.http()
    });

    let board = Array(16).fill(0);
    let score = 0;
    let address = null;

    const grid = document.getElementById('grid');
    const scoreEl = document.getElementById('score');
    const submitBtn = document.getElementById('submitBtn');
    const connectBtn = document.getElementById('connectBtn');

    function init() {
      board = Array(16).fill(0);
      score = 0;
      addNumber(); addNumber();
      render();
    }

    function addNumber() {
      let empty = board.map((v,i) => v===0 ? i : null).filter(v => v!==null);
      if (empty.length) {
        let idx = empty[Math.floor(Math.random()*empty.length)];
        board[idx] = Math.random() < 0.9 ? 2 : 4;
      }
    }

    function render() {
      grid.innerHTML = '';
      board.forEach((v,i) => {
        const tile = document.createElement('div');
        tile.className = `w-24 h-24 flex items-center justify-center text-4xl font-bold rounded tile ${v ? `tile-${v}` : 'bg-gray-600'}`;
        tile.textContent = v || '';
        grid.appendChild(tile);
      });
      scoreEl.textContent = `Score: ${score}`;
      submitBtn.classList.toggle('hidden', score < 512 || !address);
    }

    async function submitScore() {
      if (!address) return alert('Connect v√≠ tr∆∞·ªõc!');
      const walletClient = await wagmi.createWalletClient({
        chain: { id: 5042002 },
        transport: wagmi.custom(window.ethereum)
      });
      const [account] = await walletClient.getAddresses();
      await walletClient.writeContract({
        address: CONTRACT,
        abi: ABI,
        functionName: 'submitScore',
        args: [BigInt(score)],
        account
      });
      alert('Score submitted on Arc chain!');
    }

    connectBtn.onclick = async () => {
      const { open } = await wagmi.createConnector(wagmi.injected());
      await open();
      address = (await client.getAddresses())[0];
      connectBtn.textContent = `Connected: ${address.slice(0,6)}...${address.slice(-4)}`;
    };

    submitBtn.onclick = submitScore;

    document.addEventListener('keydown', e => {
      if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) {
        e.preventDefault();
        // logic move (up/down/left/right) ‚Äì copy ng·∫Øn g·ªçn, b·∫°n c√≥ th·ªÉ m·ªü r·ªông
        let moved = false;
        // ... (logic move 2048 ƒë∆°n gi·∫£n ~100 d√≤ng, m√¨nh r√∫t g·ªçn ƒë·ªÉ 1 file)
        if (moved) {
          addNumber();
          render();
        }
      }
    });

    init();
  </script>
</body>
</html>